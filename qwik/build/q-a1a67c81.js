import{d as r,F as a,H as n,g as c}from"./q-71956c83.js";const o=[{text:"Node Middleware",id:"node-middleware",level:1},{text:"Installation",id:"installation",level:2},{text:"Production build",id:"production-build",level:2},{text:"Dev serve",id:"dev-serve",level:2},{text:"Production deploy",id:"production-deploy",level:2},{text:"CSRF Protection",id:"csrf-protection",level:3}],s={title:"Qwik City - Node Middleware",meta:[],styles:[],links:[],frontmatter:{contributors:["adamdbradley","manucorporat","mousaAM","reemardelarosa","mhevery"]}},h={title:"Qwik City - Node Middleware",contributors:["adamdbradley","manucorporat","mousaAM","reemardelarosa","mhevery"]};function i(l){const e=Object.assign({h1:"h1",a:"a",span:"span",p:"p",ul:"ul",li:"li",h2:"h2",code:"code",div:"div",pre:"pre",em:"em",blockquote:"blockquote",h3:"h3"},l.components);return n(c,{children:[n(e.h1,{id:"node-middleware",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#node-middleware",children:n(e.span,{class:"icon icon-link"})}),"Node Middleware"]}),`
`,n(e.p,{children:"Qwik City Node middleware allows you to connect Qwik City to a Node.js server which uses the common middleware functionality. Some Node servers include:"}),`
`,n(e.ul,{children:[`
`,n(e.li,{children:n(e.a,{href:"https://expressjs.com/",children:"Express"})}),`
`,n(e.li,{children:n(e.a,{href:"https://fastify.io/",children:"Fastify"})}),`
`,n(e.li,{children:n(e.a,{href:"https://www.npmjs.com/package/connect",children:"Connect"})}),`
`,n(e.li,{children:n(e.a,{href:"https://www.npmjs.com/package/polka",children:"Polka"})}),`
`]}),`
`,n(e.h2,{id:"installation",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#installation",children:n(e.span,{class:"icon icon-link"})}),"Installation"]}),`
`,n(e.p,{children:["To integrate the ",n(e.code,{children:"node"})," adapter, use the ",n(e.code,{children:"add"})," command:"]}),`
`,n(e.ul,{children:[`
`,n(e.li,{children:["For ",n(e.a,{href:"https://expressjs.com/",children:"Express"}),":"]}),`
`]}),`
`,n(e.div,{"data-rehype-pretty-code-fragment":"",children:n(e.pre,{"data-language":"shell","data-theme":"default",children:n(e.code,{"data-language":"shell","data-theme":"default",children:n(e.span,{class:"line",children:[n(e.span,{style:{color:"#DCDCAA"},children:"npm"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"run"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"qwik"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"add"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"express"})]})})})}),`
`,n(e.ul,{children:[`
`,n(e.li,{children:["For ",n(e.a,{href:"https://fastify.io/",children:"Fastify"})]}),`
`]}),`
`,n(e.div,{"data-rehype-pretty-code-fragment":"",children:n(e.pre,{"data-language":"shell","data-theme":"default",children:n(e.code,{"data-language":"shell","data-theme":"default",children:n(e.span,{class:"line",children:[n(e.span,{style:{color:"#DCDCAA"},children:"npm"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"run"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"qwik"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"add"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"fastify"})]})})})}),`
`,n(e.h2,{id:"production-build",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#production-build",children:n(e.span,{class:"icon icon-link"})}),"Production build"]}),`
`,n(e.p,{children:["To build the application for production, use the ",n(e.code,{children:"build"})," command, this command will automatically run ",n(e.code,{children:"npm run build.server"})," and ",n(e.code,{children:"npm run build.client"}),":"]}),`
`,n(e.div,{"data-rehype-pretty-code-fragment":"",children:n(e.pre,{"data-language":"shell","data-theme":"default",children:n(e.code,{"data-language":"shell","data-theme":"default",children:n(e.span,{class:"line",children:[n(e.span,{style:{color:"#DCDCAA"},children:"npm"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"run"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"build"})]})})})}),`
`,n(e.h2,{id:"dev-serve",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#dev-serve",children:n(e.span,{class:"icon icon-link"})}),"Dev serve"]}),`
`,n(e.p,{children:"To deploy the application for development:"}),`
`,n(e.div,{"data-rehype-pretty-code-fragment":"",children:n(e.pre,{"data-language":"shell","data-theme":"default",children:n(e.code,{"data-language":"shell","data-theme":"default",children:n(e.span,{class:"line",children:[n(e.span,{style:{color:"#DCDCAA"},children:"npm"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"run"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"serve"})]})})})}),`
`,n(e.h2,{id:"production-deploy",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#production-deploy",children:n(e.span,{class:"icon icon-link"})}),"Production deploy"]}),`
`,n(e.p,{children:["Since you are choosing Node, here you are in your own, after running ",n(e.code,{children:"npm run build"}),":"]}),`
`,n(e.ul,{children:[`
`,n(e.li,{children:["The ",n(e.code,{children:"dist"})," folder will be created including all the static files."]}),`
`,n(e.li,{children:["The ",n(e.code,{children:"server"})," folder will be created including all node server files."]}),`
`]}),`
`,n(e.p,{children:["In order to deploy the server, you need to run the ",n(e.code,{children:"server/entry.[server].js"})," file in the server of your choice, where ",n(e.code,{children:"[server]"})," can be ",n(e.a,{href:"https://expressjs.com/",children:"express"})," or ",n(e.a,{href:"https://fastify.io/",children:"fastify"}),"."]}),`
`,n(e.p,{children:["It's ",n(e.em,{children:["very important to correctly configure the ",n(e.code,{children:"ORIGIN"})," env variable"]}),", which is used to check against ",n(e.a,{href:"https://owasp.org/www-community/attacks/csrf",children:"CSRF attacks"}),". The origin must match the origin of the client application."]}),`
`,n(e.blockquote,{children:[`
`,n(e.p,{children:["For example, if you plan to deploy your application to ",n(e.code,{children:"https://example.com/app"}),", then you need to set the ",n(e.code,{children:"ORIGIN"})," environment variable to ",n(e.code,{children:"https://example.com"}),"."]}),`
`,n(e.div,{"data-rehype-pretty-code-fragment":"",children:n(e.pre,{"data-language":"shell","data-theme":"default",children:n(e.code,{"data-language":"shell","data-theme":"default",children:n(e.span,{class:"line",children:[n(e.span,{style:{color:"#9CDCFE"},children:"ORIGIN"}),n(e.span,{style:{color:"#D4D4D4"},children:"="}),n(e.span,{style:{color:"#CE9178"},children:"https://example.com"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#DCDCAA"},children:"node"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#CE9178"},children:"server/entry.express"})]})})})}),`
`]}),`
`,n(e.h3,{id:"csrf-protection",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#csrf-protection",children:n(e.span,{class:"icon icon-link"})}),"CSRF Protection"]}),`
`,n(e.p,{children:["By default, all Qwik City applications are protected against ",n(e.a,{href:"https://owasp.org/www-community/attacks/csrf",children:"CSRF attacks"})," for all POST, PATCH, DELETE form submits."]}),`
`,n(e.p,{children:["This protection is enabled by default and it's the reason why you need to set the ",n(e.code,{children:"ORIGIN"})," environment variable when deploying your application for production."]}),`
`,n(e.p,{children:["If you want to disable CSRF protection, you can set ",n(e.code,{children:"checkOrigin: false"})," in the ",n(e.code,{children:"createQwikCity()"})," options in ",n(e.code,{children:"src/entry.express.tsx"}),":"]}),`
`,n(e.div,{"data-rehype-pretty-code-fragment":"",children:[n(e.div,{"data-rehype-pretty-code-title":"","data-language":"tsx","data-theme":"default",children:"entry.express.tsx"}),n(e.pre,{"data-language":"tsx","data-theme":"default",children:n(e.code,{"data-language":"tsx","data-theme":"default",children:[n(e.span,{class:"line",children:n(e.span,{style:{color:"#6A9955"},children:"// ..."})}),`
`,n(e.span,{class:"line",children:[n(e.span,{style:{color:"#569CD6"},children:"const"}),n(e.span,{style:{color:"#D4D4D4"},children:" { "}),n(e.span,{style:{color:"#4FC1FF"},children:"router"}),n(e.span,{style:{color:"#D4D4D4"},children:", "}),n(e.span,{style:{color:"#4FC1FF"},children:"notFound"}),n(e.span,{style:{color:"#D4D4D4"},children:", "}),n(e.span,{style:{color:"#4FC1FF"},children:"staticFile"}),n(e.span,{style:{color:"#D4D4D4"},children:" } = "}),n(e.span,{style:{color:"#DCDCAA"},children:"createQwikCity"}),n(e.span,{style:{color:"#D4D4D4"},children:"({"})]}),`
`,n(e.span,{class:"line",children:[n(e.span,{style:{color:"#D4D4D4"},children:"  "}),n(e.span,{style:{color:"#9CDCFE"},children:"render"}),n(e.span,{style:{color:"#D4D4D4"},children:","})]}),`
`,n(e.span,{class:"line",children:[n(e.span,{style:{color:"#D4D4D4"},children:"  "}),n(e.span,{style:{color:"#9CDCFE"},children:"qwikCityPlan"}),n(e.span,{style:{color:"#D4D4D4"},children:","})]}),`
`,n(e.span,{class:"line",children:[n(e.span,{style:{color:"#D4D4D4"},children:"  "}),n(e.span,{style:{color:"#9CDCFE"},children:"manifest"}),n(e.span,{style:{color:"#D4D4D4"},children:","})]}),`
`,n(e.span,{class:"line line--highlighted",children:[n(e.span,{style:{color:"#D4D4D4"},children:"  "}),n(e.span,{style:{color:"#9CDCFE"},class:"word",children:"checkOrigin"}),n(e.span,{style:{color:"#9CDCFE"},children:":"}),n(e.span,{style:{color:"#D4D4D4"},children:" "}),n(e.span,{style:{color:"#569CD6"},children:"false"}),n(e.span,{style:{color:"#D4D4D4"},children:","})]}),`
`,n(e.span,{class:"line",children:n(e.span,{style:{color:"#D4D4D4"},children:"});"})}),`
`,n(e.span,{class:"line",children:n(e.span,{style:{color:"#6A9955"},children:"// ..."})})]})})]})]})}function d(l={}){const{wrapper:e}=l.components||{};return e?n(e,Object.assign({},l,{children:n(i,l)})):i(l)}const p=()=>r(a,{children:r(d,{},3,null)},3,"ZyBkNdVI");export{p as default,h as frontmatter,s as head,o as headings};
