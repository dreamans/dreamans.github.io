import{d as s,F as r,H as e,g as o}from"./q-71956c83.js";import{C as i}from"./q-39a884a5.js";const h=[{text:"Bundle Optimization",id:"bundle-optimization",level:1},{text:"Symbols vs Chunks",id:"symbols-vs-chunks",level:2},{text:"Optimal Symbol Distribution",id:"optimal-symbol-distribution",level:2},{text:"qwikVite() Plugin",id:"qwikvite-plugin",level:2},{text:"Runtime analytics",id:"runtime-analytics",level:2},{text:"Service worker",id:"service-worker",level:2},{text:"Events",id:"events",level:2},{text:"qprefetch custom event details.",id:"qprefetch-custom-event-details",level:3},{text:"qsymbol custom event details.",id:"qsymbol-custom-event-details",level:3},{text:"Waterfall",id:"waterfall",level:2}],D={title:"Qwik City - Bundle Optimization",meta:[],styles:[],links:[],frontmatter:{contributors:["mhevery"]}},p={title:"Qwik City - Bundle Optimization",contributors:["mhevery"]};function c(n){const l=Object.assign({h1:"h1",a:"a",span:"span",p:"p",h2:"h2",code:"code",div:"div",pre:"pre",ul:"ul",li:"li",ol:"ol",blockquote:"blockquote",strong:"strong",h3:"h3"},n.components);return e(o,{children:[e(l.h1,{id:"bundle-optimization",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#bundle-optimization",children:e(l.span,{class:"icon icon-link"})}),"Bundle Optimization"]}),`
`,e(l.p,{children:"Bundle Optimization refers to the process of deciding which symbol goes to which bundle so that the application can co-locate the code that is used together.  Having the symbols co-located can make the application load faster."}),`
`,e(l.h2,{id:"symbols-vs-chunks",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#symbols-vs-chunks",children:e(l.span,{class:"icon icon-link"})}),"Symbols vs Chunks"]}),`
`,e(l.p,{children:["Symbols are individual lazy-loadable pieces in Qwik. A symbol is created whenever you use the ",e(l.code,{children:"__$(__)"})," in your source code."]}),`
`,e(l.p,{children:["For example, the code below creates two symbols from ",e(l.code,{children:"component$"})," and ",e(l.code,{children:"onClick$"}),"."]}),`
`,e(i,{src:"/src/routes/demo/state/counter-signal/index.tsx",style:{height:"6em"},children:e(l.div,{"data-rehype-pretty-code-fragment":"",children:e(l.pre,{"data-language":"tsx","data-theme":"default",children:e(l.code,{"data-language":"tsx","data-theme":"default",children:[e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"import"}),e(l.span,{style:{color:"#D4D4D4"},children:" { "}),e(l.span,{style:{color:"#9CDCFE"},class:"word",children:"component$"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#9CDCFE"},children:"useSignal"}),e(l.span,{style:{color:"#D4D4D4"},children:" } "}),e(l.span,{style:{color:"#C586C0"},children:"from"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#CE9178"},children:"'@builder.io/qwik'"}),e(l.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,e(l.span,{class:"line",children:" "}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#C586C0"},children:"default"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#DCDCAA"},class:"word",children:"component$"}),e(l.span,{style:{color:"#D4D4D4"},children:"(() "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#569CD6"},children:"const"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#4FC1FF"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:" = "}),e(l.span,{style:{color:"#DCDCAA"},children:"useSignal"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#B5CEA8"},children:"0"}),e(l.span,{style:{color:"#D4D4D4"},children:");"})]}),`
`,e(l.span,{class:"line",children:" "}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#C586C0"},children:"return"}),e(l.span,{style:{color:"#D4D4D4"},children:" ("})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#808080"},children:"<"}),e(l.span,{style:{color:"#569CD6"},children:"button"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},class:"word",children:"onClick$"}),e(l.span,{style:{color:"#D4D4D4"},children:"="}),e(l.span,{style:{color:"#569CD6"},children:"{"}),e(l.span,{style:{color:"#D4D4D4"},children:"() "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"value"}),e(l.span,{style:{color:"#D4D4D4"},children:"++"}),e(l.span,{style:{color:"#569CD6"},children:"}"}),e(l.span,{style:{color:"#808080"},children:">"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"      Increment "}),e(l.span,{style:{color:"#569CD6"},children:"{"}),e(l.span,{style:{color:"#9CDCFE"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"value"}),e(l.span,{style:{color:"#569CD6"},children:"}"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#808080"},children:"</"}),e(l.span,{style:{color:"#569CD6"},children:"button"}),e(l.span,{style:{color:"#808080"},children:">"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"  );"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"});"})})]})})})}),`
`,e(l.p,{children:"The optimizer rewrites the above code to something like this:"}),`
`,e(l.p,{children:["File: ",e(l.code,{children:"chunk-1.js"})]}),`
`,e(l.div,{"data-rehype-pretty-code-fragment":"",children:e(l.pre,{"data-language":"tsx","data-theme":"default",children:e(l.code,{"data-language":"tsx","data-theme":"default",children:[e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#C586C0"},children:"default"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#DCDCAA"},children:"componentQRL"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#DCDCAA"},children:"qrl"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#CE9178"},children:"'./chunk-1.js'"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#CE9178"},children:"'s_ABC123'"}),e(l.span,{style:{color:"#D4D4D4"},children:"));"})]}),`
`,e(l.span,{class:"line",children:" "}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#569CD6"},children:"const"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#DCDCAA"},children:"s_ABC123"}),e(l.span,{style:{color:"#D4D4D4"},children:" = () "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#569CD6"},children:"const"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#4FC1FF"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:" = "}),e(l.span,{style:{color:"#DCDCAA"},children:"useSignal"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#B5CEA8"},children:"0"}),e(l.span,{style:{color:"#D4D4D4"},children:");"})]}),`
`,e(l.span,{class:"line",children:" "}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#C586C0"},children:"return"}),e(l.span,{style:{color:"#D4D4D4"},children:" ("})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#808080"},children:"<"}),e(l.span,{style:{color:"#569CD6"},children:"button"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},children:"onClickQRL"}),e(l.span,{style:{color:"#D4D4D4"},children:"="}),e(l.span,{style:{color:"#569CD6"},children:"{"}),e(l.span,{style:{color:"#DCDCAA"},children:"qrl"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#CE9178"},children:"'/.chunk-1.js'"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#CE9178"},children:"'s_XYZ342'"}),e(l.span,{style:{color:"#D4D4D4"},children:")"}),e(l.span,{style:{color:"#569CD6"},children:"}"}),e(l.span,{style:{color:"#808080"},children:">"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"      Increment "}),e(l.span,{style:{color:"#569CD6"},children:"{"}),e(l.span,{style:{color:"#9CDCFE"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"value"}),e(l.span,{style:{color:"#569CD6"},children:"}"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#808080"},children:"</"}),e(l.span,{style:{color:"#569CD6"},children:"button"}),e(l.span,{style:{color:"#808080"},children:">"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"  );"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"};"})}),`
`,e(l.span,{class:"line",children:" "}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#569CD6"},children:"const"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#DCDCAA"},children:"s_XYZ432"}),e(l.span,{style:{color:"#D4D4D4"},children:" = () "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#569CD6"},children:"const"}),e(l.span,{style:{color:"#D4D4D4"},children:" ["}),e(l.span,{style:{color:"#4FC1FF"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:"] = "}),e(l.span,{style:{color:"#DCDCAA"},children:"useLexicalScop"}),e(l.span,{style:{color:"#D4D4D4"},children:"();"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#C586C0"},children:"return"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},children:"count"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"value"}),e(l.span,{style:{color:"#D4D4D4"},children:"++;"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})}),`
`,e(l.p,{children:["In the above example, all of the symbols (",e(l.code,{children:"sABC123"})," and ",e(l.code,{children:"s_XYZ432"}),") are co-located in the same chunk (",e(l.code,{children:"./chunk-1.js"}),")."]}),`
`,e(l.p,{children:"Chunks are JavaScript bundles that can contain one or more symbols."}),`
`,e(l.h2,{id:"optimal-symbol-distribution",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#optimal-symbol-distribution",children:e(l.span,{class:"icon icon-link"})}),"Optimal Symbol Distribution"]}),`
`,e(l.p,{children:"You can think of bundle optimization as a slider that allows us to optimize the symbol delivery."}),`
`,e(l.ul,{children:[`
`,e(l.li,{children:"On one end of the slider, we have a single chunk that contains all of the symbols. This is equivalent to the application without any sort of lazy loading. (This is how most applications are written today.)"}),`
`,e(l.li,{children:"On the other extreme of the slider, we have a separate chunk for each symbol. This is how Qwik applications behave during development. Each symbol is in its own chunk."}),`
`]}),`
`,e(l.p,{children:"The problem with a single chunk is:"}),`
`,e(l.ul,{children:[`
`,e(l.li,{children:"It will contain many symbols which are not needed by the client. (Wasted bandwidth.)"}),`
`,e(l.li,{children:"The client can't run any symbols until the whole chunk is loaded."}),`
`]}),`
`,e(l.p,{children:"The problem with a separate chunk for each symbol is:"}),`
`,e(l.ul,{children:[`
`,e(l.li,{children:"The client will have to make many requests to load all of the chunks, often leading to undesirable waterfall requests."}),`
`]}),`
`,e(l.p,{children:"The optimal solution is somewhere in the middle. We want to have a small number of chunks, but we also want to have the symbols that are used together to be co-located in the same chunk. Having a small number of chunks allows us to prioritize the order in which chunks load but at the same time amortize the cost of making HTTP requests. Having symbols co-located allows us to minimize the waterfall."}),`
`,e(l.p,{children:["The good news is that with Qwik you are in full control of which symbol goes into which chunk. Normally breaking up your application for lazy loading requires the developer to write dynamic imports and re-factor the code. In Qwik, all ",e(l.code,{children:"$()"})," are potential lazy load locations, all that is needed is to inform the bundler how to distribute the symbols."]}),`
`,e(l.h2,{id:"qwikvite-plugin",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#qwikvite-plugin",children:e(l.span,{class:"icon icon-link"})}),e(l.code,{children:"qwikVite()"})," Plugin"]}),`
`,e(l.p,{children:[e(l.code,{children:"qwikVite()"})," plugin inside your ",e(l.code,{children:"vite.config.ts"})," controls the symbol distribution. Normally the ",e(l.code,{children:"entryStrategy"})," is set to ",e(l.code,{children:"smart"})," which allows the Qwik to make heuristic guesses as to how the symbols should be lazy loaded. But it is possible to override the heuristic by providing ",e(l.code,{children:"manual"})," configuration like this in ",e(l.code,{children:"vite.config.ts"})," file:"]}),`
`,e(l.div,{"data-rehype-pretty-code-fragment":"",children:e(l.pre,{"data-language":"typescript","data-theme":"default",children:e(l.code,{"data-language":"typescript","data-theme":"default",children:[e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#C586C0"},children:"default"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#DCDCAA"},children:"defineConfig"}),e(l.span,{style:{color:"#D4D4D4"},children:"(() "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#569CD6"},children:"const"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#4FC1FF"},children:"routesDir"}),e(l.span,{style:{color:"#D4D4D4"},children:" = "}),e(l.span,{style:{color:"#DCDCAA"},children:"resolve"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#CE9178"},children:"'src'"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#CE9178"},children:"'routes'"}),e(l.span,{style:{color:"#D4D4D4"},children:");"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#C586C0"},children:"return"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#6A9955"},children:"// ..."})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#DCDCAA"},children:"qwikVite"}),e(l.span,{style:{color:"#D4D4D4"},children:"({"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"      "}),e(l.span,{style:{color:"#9CDCFE"},children:"entryStrategy"}),e(l.span,{style:{color:"#D4D4D4"},children:": {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"        "}),e(l.span,{style:{color:"#9CDCFE"},children:"type"}),e(l.span,{style:{color:"#D4D4D4"},children:": "}),e(l.span,{style:{color:"#CE9178"},children:"'smart'"}),e(l.span,{style:{color:"#D4D4D4"},children:","})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"        "}),e(l.span,{style:{color:"#9CDCFE"},children:"manual"}),e(l.span,{style:{color:"#D4D4D4"},children:": {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"          ..."}),e(l.span,{style:{color:"#9CDCFE"},children:"bundle"}),e(l.span,{style:{color:"#D4D4D4"},children:"('"}),e(l.span,{style:{color:"#9CDCFE"},children:"bundleA"}),e(l.span,{style:{color:"#D4D4D4"},children:"', ["})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_I5CyQjO9FjQ"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_NsnidK2eXPg"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_kDw0latGeM0"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"          ]),"})}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"          ..."}),e(l.span,{style:{color:"#9CDCFE"},children:"bundle"}),e(l.span,{style:{color:"#D4D4D4"},children:"('"}),e(l.span,{style:{color:"#9CDCFE"},children:"bundleB"}),e(l.span,{style:{color:"#D4D4D4"},children:"', ["})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_vXb90XKAnjE"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_hYpp40gCb60"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"          ]),"})}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"          ..."}),e(l.span,{style:{color:"#9CDCFE"},children:"bundle"}),e(l.span,{style:{color:"#D4D4D4"},children:"('"}),e(l.span,{style:{color:"#9CDCFE"},children:"bundleC"}),e(l.span,{style:{color:"#D4D4D4"},children:"', ["})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_AqHBIVNKf34"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_oEksvFPgMEM"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"              '"}),e(l.span,{style:{color:"#9CDCFE"},children:"s_eePwnt3YTI8"}),e(l.span,{style:{color:"#D4D4D4"},children:"',"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"          ]),"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"        },"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"      },"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"    }),"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"  };"})}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"});"})}),`
`,e(l.span,{class:"line",children:" "}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#569CD6"},children:"function"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#DCDCAA"},children:"bundle"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#9CDCFE"},children:"bundleName"}),e(l.span,{style:{color:"#D4D4D4"},children:": "}),e(l.span,{style:{color:"#4EC9B0"},children:"string"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#9CDCFE"},children:"symbols"}),e(l.span,{style:{color:"#D4D4D4"},children:": "}),e(l.span,{style:{color:"#4EC9B0"},children:"string"}),e(l.span,{style:{color:"#D4D4D4"},children:"[]) {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#C586C0"},children:"return"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},children:"symbols"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#DCDCAA"},children:"reduce"}),e(l.span,{style:{color:"#D4D4D4"},children:"(("}),e(l.span,{style:{color:"#9CDCFE"},children:"obj"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#9CDCFE"},children:"key"}),e(l.span,{style:{color:"#D4D4D4"},children:") "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#6A9955"},children:"// Sometimes symbols are prefixed with `s_`, remove it."})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#9CDCFE"},children:"obj"}),e(l.span,{style:{color:"#D4D4D4"},children:"["}),e(l.span,{style:{color:"#9CDCFE"},children:"key"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#DCDCAA"},children:"replace"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#CE9178"},children:"'s_'"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#CE9178"},children:"''"}),e(l.span,{style:{color:"#D4D4D4"},children:")] = "}),e(l.span,{style:{color:"#9CDCFE"},children:"obj"}),e(l.span,{style:{color:"#D4D4D4"},children:"["}),e(l.span,{style:{color:"#9CDCFE"},children:"key"}),e(l.span,{style:{color:"#D4D4D4"},children:"] = "}),e(l.span,{style:{color:"#9CDCFE"},children:"bundleName"}),e(l.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"    "}),e(l.span,{style:{color:"#C586C0"},children:"return"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},children:"obj"}),e(l.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  }, {} "}),e(l.span,{style:{color:"#C586C0"},children:"as"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#4EC9B0"},children:"Record"}),e(l.span,{style:{color:"#D4D4D4"},children:"<"}),e(l.span,{style:{color:"#4EC9B0"},children:"string"}),e(l.span,{style:{color:"#D4D4D4"},children:", "}),e(l.span,{style:{color:"#4EC9B0"},children:"string"}),e(l.span,{style:{color:"#D4D4D4"},children:">);"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})}),`
`,e(l.p,{children:["So the question becomes how do you get the symbol names such as ",e(l.code,{children:"s_I5CyQjO9FjQ"}),"? See the next section Runtime Analytics."]}),`
`,e(l.h2,{id:"runtime-analytics",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#runtime-analytics",children:e(l.span,{class:"icon icon-link"})}),"Runtime analytics"]}),`
`,e(l.p,{children:"The fundamental problem to solve is that determining the optimal bundles is not statically possible. The ideal bundles will depend on the user's behavior. Only after observing users' behavior can we determine which symbols are used together."}),`
`,e(l.p,{children:"To collect symbol usage from a running application:"}),`
`,e(l.ol,{children:[`
`,e(l.li,{children:["Insert this code into your app:",`
`,e(l.div,{"data-rehype-pretty-code-fragment":"",children:e(l.pre,{"data-language":"html","data-theme":"default",children:e(l.code,{"data-language":"html","data-theme":"default",children:[e(l.span,{class:"line",children:[e(l.span,{style:{color:"#808080"},children:"<"}),e(l.span,{style:{color:"#569CD6"},children:"script"}),e(l.span,{style:{color:"#808080"},children:">"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#9CDCFE"},children:"window"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"symbols"}),e(l.span,{style:{color:"#D4D4D4"},children:" = [];"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#9CDCFE"},children:"document"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#DCDCAA"},children:"addEventListener"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#CE9178"},children:"'qsymbol'"}),e(l.span,{style:{color:"#D4D4D4"},children:", ("}),e(l.span,{style:{color:"#9CDCFE"},children:"e"}),e(l.span,{style:{color:"#D4D4D4"},children:") "}),e(l.span,{style:{color:"#569CD6"},children:"=>"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#9CDCFE"},children:"window"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"symbols"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#DCDCAA"},children:"push"}),e(l.span,{style:{color:"#D4D4D4"},children:"("}),e(l.span,{style:{color:"#9CDCFE"},children:"e"}),e(l.span,{style:{color:"#D4D4D4"},children:"."}),e(l.span,{style:{color:"#9CDCFE"},children:"detail"}),e(l.span,{style:{color:"#D4D4D4"},children:"));"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#808080"},children:"</"}),e(l.span,{style:{color:"#569CD6"},children:"script"}),e(l.span,{style:{color:"#808080"},children:">"})]})]})})}),`
`]}),`
`,e(l.li,{children:"Perform some set of operations mimicking user behavior."}),`
`,e(l.li,{children:["Open the console and type ",e(l.code,{children:"symbols"})," to see the list of symbols used. Used that information to update the ",e(l.code,{children:"vite.config.ts"})," file."]}),`
`]}),`
`,e(l.blockquote,{children:[`
`,e(l.p,{children:[e(l.strong,{children:"NOTE:"})," We are looking into creating better ways of collecting this information in the future."]}),`
`]}),`
`,e(l.blockquote,{children:[`
`,e(l.p,{children:[e(l.strong,{children:"NOTE:"})," Symbols hashes are designed to be stable even across many compilations. However, if the code undergoes complex refactoring it is possible for the hash to change. This will not break the application, but it may cause the symbol to be moved to a different sub-optimal chunk until runtime analytics can be collected again."]}),`
`]}),`
`,e(l.h2,{id:"service-worker",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#service-worker",children:e(l.span,{class:"icon icon-link"})}),"Service worker"]}),`
`,e(l.p,{children:"Qwik apps employ a service worker to ensure that bundles are prefetched into the browser's cache and that any user interaction would result in a cache hit, hence no delay in interaction."}),`
`,e(l.p,{children:["See ",e(l.a,{href:"/docs/advanced/speculative-module-fetching/",children:"Speculative Module Fetching"}),"."]}),`
`,e(l.h2,{id:"events",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#events",children:e(l.span,{class:"icon icon-link"})}),"Events"]}),`
`,e(l.p,{children:"All information regarding when the symbols are loaded can be observed by listening to the following custom events:"}),`
`,e(l.h3,{id:"qprefetch-custom-event-details",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#qprefetch-custom-event-details",children:e(l.span,{class:"icon icon-link"})}),e(l.code,{children:"qprefetch"})," custom event details."]}),`
`,e(l.p,{children:[e(l.code,{children:"qprefetch"}),` event is fired when a new code path is exposed to the user by rendering a new application view. (For example, rendering a new model dialog will have a new button. We would like the ensure that the new button code is prefetch so that if the user interacts with the button there will be no delay.)
Usually, a service worker listens to the `,e(l.code,{children:"qprefetch"})," event and loads the symbol into the cache. The service worker has a map of symbols to bundles, and it uses this information to determine which bundles to prefetch based on a symbol."]}),`
`,e(l.div,{"data-rehype-pretty-code-fragment":"",children:e(l.pre,{"data-language":"typescript","data-theme":"default",children:e(l.code,{"data-language":"typescript","data-theme":"default",children:[e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#569CD6"},children:"interface"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#4EC9B0"},children:"QPrefetchDetail"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#6A9955"},children:"/// A list of symbols to prefetch."})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#9CDCFE"},children:"symbols"}),e(l.span,{style:{color:"#D4D4D4"},children:": "}),e(l.span,{style:{color:"#4EC9B0"},children:"string"}),e(l.span,{style:{color:"#D4D4D4"},children:"[];"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})}),`
`,e(l.h3,{id:"qsymbol-custom-event-details",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#qsymbol-custom-event-details",children:e(l.span,{class:"icon icon-link"})}),e(l.code,{children:"qsymbol"})," custom event details."]}),`
`,e(l.p,{children:[e(l.code,{children:"qsymbol"})," event is fired every time Qwik needs to resolve a symbol. Listening to this event can give you insight into when different symbols are loaded by your application. The information can then be used to better optimize your bundles by putting symbols that are needed together in the same bundle."]}),`
`,e(l.div,{"data-rehype-pretty-code-fragment":"",children:e(l.pre,{"data-language":"typescript","data-theme":"default",children:e(l.code,{"data-language":"typescript","data-theme":"default",children:[e(l.span,{class:"line",children:[e(l.span,{style:{color:"#C586C0"},children:"export"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#569CD6"},children:"interface"}),e(l.span,{style:{color:"#D4D4D4"},children:" "}),e(l.span,{style:{color:"#4EC9B0"},children:"QSymbolDetail"}),e(l.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#6A9955"},children:"/// Optional DOM event which triggered the symbol resolution."})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#9CDCFE"},children:"element"}),e(l.span,{style:{color:"#D4D4D4"},children:"?: "}),e(l.span,{style:{color:"#4EC9B0"},children:"Element"}),e(l.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#6A9955"},children:"/// Request time when the symbol was resolved."})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#9CDCFE"},children:"reqTime"}),e(l.span,{style:{color:"#D4D4D4"},children:": "}),e(l.span,{style:{color:"#4EC9B0"},children:"number"}),e(l.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#6A9955"},children:"/// Symbol being resolved."})]}),`
`,e(l.span,{class:"line",children:[e(l.span,{style:{color:"#D4D4D4"},children:"  "}),e(l.span,{style:{color:"#9CDCFE"},children:"symbol"}),e(l.span,{style:{color:"#D4D4D4"},children:": "}),e(l.span,{style:{color:"#4EC9B0"},children:"string"}),e(l.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,e(l.span,{class:"line",children:e(l.span,{style:{color:"#D4D4D4"},children:"}"})})]})})}),`
`,e(l.h2,{id:"waterfall",children:[e(l.a,{"aria-hidden":"true",tabindex:"-1",href:"#waterfall",children:e(l.span,{class:"icon icon-link"})}),"Waterfall"]}),`
`,e(l.p,{children:["The service worker attempts to minimize the waterfall by prefetching the bundles. To be able to do that the service worker has a ",e(l.code,{children:"manifest"})," of symbols and chunks. The ",e(l.code,{children:"manifest"})," represents a full graph of all of the symbols and their corresponding chunks. It also knows the import graph, so if a symbol is prefetched, the service worker will also prefetch all other symbols which are needed as part of the import graph."]})]})}function t(n={}){const{wrapper:l}=n.components||{};return l?e(l,Object.assign({},n,{children:e(c,n)})):c(n)}const y=()=>s(r,{children:s(t,{},3,null)},3,"lVlV8fRQ");export{y as default,p as frontmatter,D as head,h as headings};
