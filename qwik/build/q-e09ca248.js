import{d as t,F as r,H as l,g as d}from"./q-71956c83.js";const o=[{text:"Netlify Edge Adapter",id:"netlify-edge-adapter",level:1},{text:"Installation",id:"installation",level:2},{text:"Production build",id:"production-build",level:2},{text:"Dev deploy",id:"dev-deploy",level:2},{text:"Production deploy",id:"production-deploy",level:2},{text:"Advanced",id:"advanced",level:2},{text:"Netlify Edge Entry Middleware",id:"netlify-edge-entry-middleware",level:3},{text:"Netlify Edge Functions Declarations",id:"netlify-edge-functions-declarations",level:3},{text:"Netlify Request Context",id:"netlify-request-context",level:3},{text:"Environment variables",id:"environment-variables",level:3}],s={title:"Qwik City - Netlify Edge Adapter and Middleware",meta:[],styles:[],links:[],frontmatter:{contributors:["adamdbradley","manucorporat","reemardelarosa","mhevery"]}},h={title:"Qwik City - Netlify Edge Adapter and Middleware",contributors:["adamdbradley","manucorporat","reemardelarosa","mhevery"]};function i(n){const e=Object.assign({h1:"h1",a:"a",span:"span",p:"p",h2:"h2",code:"code",div:"div",pre:"pre",blockquote:"blockquote",h3:"h3",ul:"ul",li:"li"},n.components);return l(d,{children:[l(e.h1,{id:"netlify-edge-adapter",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#netlify-edge-adapter",children:l(e.span,{class:"icon icon-link"})}),"Netlify Edge Adapter"]}),`
`,l(e.p,{children:["Qwik City Netlify Edge adapter allows you to connect Qwik City to ",l(e.a,{href:"https://docs.netlify.com/edge-functions/overview/",children:"Netlify Edge Functions"}),"."]}),`
`,l(e.h2,{id:"installation",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#installation",children:l(e.span,{class:"icon icon-link"})}),"Installation"]}),`
`,l(e.p,{children:["To integrate the ",l(e.code,{children:"netlify-edge"})," adapter, use the ",l(e.code,{children:"add"})," command:"]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:l(e.pre,{"data-language":"shell","data-theme":"default",children:l(e.code,{"data-language":"shell","data-theme":"default",children:l(e.span,{class:"line",children:[l(e.span,{style:{color:"#DCDCAA"},children:"npm"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"run"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"qwik"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"add"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"netlify-edge"})]})})})}),`
`,l(e.blockquote,{children:[`
`,l(e.p,{children:["It will automatically install the required dependencies, including the ",l(e.a,{href:"https://cli.netlify.com/",children:"Netlify CLI"}),"."]}),`
`]}),`
`,l(e.p,{children:["The adapter will add a new ",l(e.code,{children:"vite.config.ts"})," within the ",l(e.code,{children:"adapters/"})," directory, and a new entry file will be created, such as:"]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:l(e.pre,{"data-language":"shell","data-theme":"default",children:l(e.code,{"data-language":"shell","data-theme":"default",children:[l(e.span,{class:"line",children:[l(e.span,{style:{color:"#DCDCAA"},children:"└──"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"adapters/"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"    "}),l(e.span,{style:{color:"#DCDCAA"},children:"└──"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"netlify-edge/"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"        "}),l(e.span,{style:{color:"#DCDCAA"},children:"└──"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"vite.config.ts"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#DCDCAA"},children:"└──"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"src/"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"    "}),l(e.span,{style:{color:"#DCDCAA"},children:"└──"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"entry.netlify-edge.tsx"})]})]})})}),`
`,l(e.p,{children:["Additionally, within the ",l(e.code,{children:"package.json"}),", the ",l(e.code,{children:"build.server"})," and ",l(e.code,{children:"deploy"})," scripts will be updated."]}),`
`,l(e.h2,{id:"production-build",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#production-build",children:l(e.span,{class:"icon icon-link"})}),"Production build"]}),`
`,l(e.p,{children:["To build the application for production, use the ",l(e.code,{children:"build"})," command, this command will automatically run ",l(e.code,{children:"npm run build.server"})," and ",l(e.code,{children:"npm run build.client"}),":"]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:l(e.pre,{"data-language":"shell","data-theme":"default",children:l(e.code,{"data-language":"shell","data-theme":"default",children:l(e.span,{class:"line",children:[l(e.span,{style:{color:"#DCDCAA"},children:"npm"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"run"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"build"})]})})})}),`
`,l(e.p,{children:l(e.a,{href:"https://github.com/BuilderIO/qwik/blob/main/starters/adapters/netlify-edge/README.md",children:"Read the full guide here"})}),`
`,l(e.h2,{id:"dev-deploy",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#dev-deploy",children:l(e.span,{class:"icon icon-link"})}),"Dev deploy"]}),`
`,l(e.p,{children:"To deploy the application for development:"}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:l(e.pre,{"data-language":"shell","data-theme":"default",children:l(e.code,{"data-language":"shell","data-theme":"default",children:l(e.span,{class:"line",children:[l(e.span,{style:{color:"#DCDCAA"},children:"npm"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"run"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"deploy"})]})})})}),`
`,l(e.p,{children:["Notice that you might need a ",l(e.a,{href:"https://docs.netlify.com/get-started/",children:"Netlify account"})," in order to complete this step!"]}),`
`,l(e.h2,{id:"production-deploy",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#production-deploy",children:l(e.span,{class:"icon icon-link"})}),"Production deploy"]}),`
`,l(e.p,{children:["After installing the integration using ",l(e.code,{children:"npm run qwik add netlify-edge"}),", the project is ready to be deployed to Netlify. However, you will need to create a git repository and push the code to it."]}),`
`,l(e.p,{children:["Please refer to the Netlify docs for more information on how to deploy your site: ",l(e.a,{href:"https://docs.netlify.com/site-deploys/create-deploys/",children:"Netlify docs"})]}),`
`,l(e.h2,{id:"advanced",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#advanced",children:l(e.span,{class:"icon icon-link"})}),"Advanced"]}),`
`,l(e.h3,{id:"netlify-edge-entry-middleware",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#netlify-edge-entry-middleware",children:l(e.span,{class:"icon icon-link"})}),"Netlify Edge Entry Middleware"]}),`
`,l(e.p,{children:["When the ",l(e.code,{children:"netlify-edge"})," adapter is added, a new entry file will be created at ",l(e.code,{children:"src/entry.netlify-edge.tsx"}),". Below is an example of using the built-in middleware within the entry file."]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:[l(e.div,{"data-rehype-pretty-code-title":"","data-language":"tsx","data-theme":"default",children:"src/entry.netlify-edge.tsx"}),l(e.pre,{"data-language":"tsx","data-theme":"default",children:l(e.code,{"data-language":"tsx","data-theme":"default",children:[l(e.span,{class:"line",children:[l(e.span,{style:{color:"#C586C0"},children:"import"}),l(e.span,{style:{color:"#D4D4D4"},children:" { "}),l(e.span,{style:{color:"#9CDCFE"},children:"createQwikCity"}),l(e.span,{style:{color:"#D4D4D4"},children:" } "}),l(e.span,{style:{color:"#C586C0"},children:"from"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"'@builder.io/qwik-city/middleware/netlify-edge'"}),l(e.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#C586C0"},children:"import"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#9CDCFE"},children:"qwikCityPlan"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#C586C0"},children:"from"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"'@qwik-city-plan'"}),l(e.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#C586C0"},children:"import"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#9CDCFE"},children:"render"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#C586C0"},children:"from"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#CE9178"},children:"'./entry.ssr'"}),l(e.span,{style:{color:"#D4D4D4"},children:";"})]}),`
`,l(e.span,{class:"line",children:" "}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#C586C0"},children:"export"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#C586C0"},children:"default"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#DCDCAA"},children:"createQwikCity"}),l(e.span,{style:{color:"#D4D4D4"},children:"({ "}),l(e.span,{style:{color:"#9CDCFE"},children:"render"}),l(e.span,{style:{color:"#D4D4D4"},children:", "}),l(e.span,{style:{color:"#9CDCFE"},children:"qwikCityPlan"}),l(e.span,{style:{color:"#D4D4D4"},children:" });"})]})]})})]}),`
`,l(e.p,{children:["The compiled middleware will be built in the ",l(e.code,{children:".netlify/edge-functions"})," directory."]}),`
`,l(e.h3,{id:"netlify-edge-functions-declarations",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#netlify-edge-functions-declarations",children:l(e.span,{class:"icon icon-link"})}),"Netlify Edge Functions Declarations"]}),`
`,l(e.p,{children:[l(e.a,{href:"https://docs.netlify.com/edge-functions/declarations/",children:"Netlify Edge Functions declarations"})," can be configured to run on specific URL patterns. Each edge function declaration associates one site path pattern with one function to execute on requests that match the path. A single request can execute a chain of edge functions from a series of declarations. A single edge function can be associated with multiple paths across various declarations."]}),`
`,l(e.p,{children:["This is useful to determine if a page response should be Server-Side Rendered (SSR) or if the response should use a static-site generated (SSG) ",l(e.code,{children:"index.html"})," file instead."]}),`
`,l(e.p,{children:["By default, the Netlify Edge adapter will generate a ",l(e.code,{children:".netlify/edge-middleware/manifest.json"})," file, which is used by the Netlify deployment to determine which paths should, and should not, use edge functions."]}),`
`,l(e.p,{children:["To override the generated manifest, you can ",l(e.a,{href:"https://docs.netlify.com/edge-functions/declarations/#add-a-declaration",children:"add a declaration"})," to the ",l(e.code,{children:"netlify.toml"})," using the ",l(e.code,{children:"[[edge_functions]]"})," config. For example:"]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:[l(e.div,{"data-rehype-pretty-code-title":"","data-language":"toml","data-theme":"default",children:"netlify.toml"}),l(e.pre,{"data-language":"toml","data-theme":"default",children:l(e.code,{"data-language":"toml","data-theme":"default",children:[l(e.span,{class:"line",children:l(e.span,{style:{color:"#D4D4D4"},children:"[[edge_functions]]"})}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"  "}),l(e.span,{style:{color:"#9CDCFE"},children:"path"}),l(e.span,{style:{color:"#D4D4D4"},children:" = "}),l(e.span,{style:{color:"#CE9178"},children:'"/admin"'})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"  "}),l(e.span,{style:{color:"#9CDCFE"},children:"function"}),l(e.span,{style:{color:"#D4D4D4"},children:" = "}),l(e.span,{style:{color:"#CE9178"},children:'"auth"'})]})]})})]}),`
`,l(e.h3,{id:"netlify-request-context",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#netlify-request-context",children:l(e.span,{class:"icon icon-link"})}),"Netlify Request Context"]}),`
`,l(e.p,{children:[l(e.a,{href:"https://docs.netlify.com/edge-functions/api/#netlify-specific-context-object",children:"Netlify context"})," is available in endpoint method's ",l(e.code,{children:"platform"})," param:"]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:l(e.pre,{"data-language":"ts","data-theme":"default",children:l(e.code,{"data-language":"ts","data-theme":"default",children:[l(e.span,{class:"line",children:[l(e.span,{style:{color:"#C586C0"},children:"export"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#569CD6"},children:"const"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#DCDCAA"},children:"onRequest"}),l(e.span,{style:{color:"#D4D4D4"},children:" = "}),l(e.span,{style:{color:"#569CD6"},children:"async"}),l(e.span,{style:{color:"#D4D4D4"},children:" ({ "}),l(e.span,{style:{color:"#9CDCFE"},children:"platform"}),l(e.span,{style:{color:"#D4D4D4"},children:" }) "}),l(e.span,{style:{color:"#569CD6"},children:"=>"}),l(e.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"  "}),l(e.span,{style:{color:"#9CDCFE"},children:"platform"}),l(e.span,{style:{color:"#D4D4D4"},children:"."}),l(e.span,{style:{color:"#DCDCAA"},children:"log"}),l(e.span,{style:{color:"#D4D4D4"},children:"("}),l(e.span,{style:{color:"#CE9178"},children:"'requested ip:'"}),l(e.span,{style:{color:"#D4D4D4"},children:", "}),l(e.span,{style:{color:"#9CDCFE"},children:"platform"}),l(e.span,{style:{color:"#D4D4D4"},children:"."}),l(e.span,{style:{color:"#9CDCFE"},children:"ip"}),l(e.span,{style:{color:"#D4D4D4"},children:");"})]}),`
`,l(e.span,{class:"line",children:l(e.span,{style:{color:"#D4D4D4"},children:"};"})})]})})}),`
`,l(e.h3,{id:"environment-variables",children:[l(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#environment-variables",children:l(e.span,{class:"icon icon-link"})}),"Environment variables"]}),`
`,l(e.div,{"data-rehype-pretty-code-fragment":"",children:l(e.pre,{"data-language":"ts","data-theme":"default",children:l(e.code,{"data-language":"ts","data-theme":"default",children:[l(e.span,{class:"line",children:[l(e.span,{style:{color:"#C586C0"},children:"export"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#569CD6"},children:"const"}),l(e.span,{style:{color:"#D4D4D4"},children:" "}),l(e.span,{style:{color:"#DCDCAA"},children:"onRequest"}),l(e.span,{style:{color:"#D4D4D4"},children:" = "}),l(e.span,{style:{color:"#569CD6"},children:"async"}),l(e.span,{style:{color:"#D4D4D4"},children:" ({ "}),l(e.span,{style:{color:"#9CDCFE"},children:"env"}),l(e.span,{style:{color:"#D4D4D4"},children:" }) "}),l(e.span,{style:{color:"#569CD6"},children:"=>"}),l(e.span,{style:{color:"#D4D4D4"},children:" {"})]}),`
`,l(e.span,{class:"line",children:[l(e.span,{style:{color:"#D4D4D4"},children:"  "}),l(e.span,{style:{color:"#9CDCFE"},children:"platform"}),l(e.span,{style:{color:"#D4D4D4"},children:"."}),l(e.span,{style:{color:"#DCDCAA"},children:"log"}),l(e.span,{style:{color:"#D4D4D4"},children:"("}),l(e.span,{style:{color:"#CE9178"},children:"'netlify serverless env read from Netlify UI or CLI'"}),l(e.span,{style:{color:"#D4D4D4"},children:", "}),l(e.span,{style:{color:"#9CDCFE"},children:"env"}),l(e.span,{style:{color:"#D4D4D4"},children:"."}),l(e.span,{style:{color:"#DCDCAA"},children:"get"}),l(e.span,{style:{color:"#D4D4D4"},children:"("}),l(e.span,{style:{color:"#CE9178"},children:"'API_KEY'"}),l(e.span,{style:{color:"#D4D4D4"},children:"));"})]}),`
`,l(e.span,{class:"line",children:l(e.span,{style:{color:"#D4D4D4"},children:"};"})})]})})}),`
`,l(e.ul,{children:[`
`,l(e.li,{children:l(e.a,{href:"https://docs.netlify.com/environment-variables/overview/#environment-variable-options",children:"Netlify Environment Variables"})}),`
`,l(e.li,{children:l(e.a,{href:"https://github.com/BuilderIO/qwik/blob/main/packages/qwik-city/middleware/netlify-edge/index.ts",children:"Netlify Edge Middleware Source"})}),`
`]})]})}function a(n={}){const{wrapper:e}=n.components||{};return e?l(e,Object.assign({},n,{children:l(i,n)})):i(n)}const p=()=>t(r,{children:t(a,{},3,null)},3,"X-FxytCw");export{p as default,h as frontmatter,s as head,o as headings};
